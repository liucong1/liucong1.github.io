webpackJsonp([1],{"09Ht":function(t,s){},"4j6Z":function(t,s){},BYMy:function(t,s){},NHnr:function(t,s,e){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var i={};e.d(i,"simulateCall",function(){return R}),e.d(i,"call",function(){return D});var a=e("7+uW"),n=e("zL8q"),l=e.n(n),r=(e("tvR6"),{name:"App",created(){"undefined"==typeof webExtensionWallet&&alert("请安装并且登录钱包")},methods:{handleMenuClick(t,s){console.log("menu click: ",t,s),this.$router.push({name:t})}}}),o={render:function(){var t=this.$createElement,s=this._self._c||t;return s("div",{attrs:{id:"app"}},[this._m(0),this._v(" "),s("router-view")],1)},staticRenderFns:[function(){var t=this.$createElement,s=this._self._c||t;return s("h1",{staticClass:"app-title"},[s("span",[this._v("扫雷争霸")])])}]};var c=e("VU/8")(r,o,!1,function(t){e("YgDj")},null,null).exports,m=e("/ocq"),u={name:"nas-rank-list",data:()=>({isLoad:!0,list:[]}),created(){this.fetchRankList()},methods:{fetchRankList(){this.isLoad=!0,this.$api.simulateCall({funcName:"listRank",args:[]}).then(t=>{t=JSON.parse(t),this.isLoad=!1;let s=t||[];s.sort((t,s)=>t.time>s.time),this.list=s,this.$message({message:"刷新英雄榜完成",type:"success"})}).catch(t=>{this.isLoad=!1,this.list=[],this.$message.error("获取英雄榜异常，请稍后再试"),console.error(t)})},replayGame(t){this.$router.push({name:"Replay",params:{id:t}})}}},h={render:function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"sec-rank-list main-section"},[e("h1",{staticClass:"title"},[t._v("英雄榜")]),t._v(" "),e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.isLoad,expression:"isLoad"}],staticClass:" rank-list-con"},[t.isLoad?t._e():e("div",[t.list.length<1?e("div",{staticClass:"empty-holder"},[t._v("\n                还木有英雄榜，去挑战一下吧:)\n            ")]):e("div",{staticClass:"rank-list"},[t._m(0),t._v(" "),t._l(t.list,function(s,i){return e("div",{key:s.id,staticClass:"list-item row clearfix"},[e("div",{staticClass:"col-1"},[t._v(t._s(i+1))]),t._v(" "),e("div",{staticClass:"col-2"},[t._v(t._s(s.from))]),t._v(" "),e("div",{staticClass:"col-3"},[t._v(t._s(s.time))]),t._v(" "),e("div",{staticClass:"col-4"},[e("el-button",{on:{click:function(e){t.replayGame(s.id)}}},[t._v("复盘")])],1),t._v(" "),e("div",{staticClass:"col-5"},[t._v(t._s(new Date(1e3*s.timestamp).toLocaleString()))])])})],2)])]),t._v(" "),e("j-play-btn")],1)},staticRenderFns:[function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"list-header row clearfix"},[e("div",{staticClass:"col-1"},[t._v("排名")]),t._v(" "),e("div",{staticClass:"col-2"},[t._v("用户")]),t._v(" "),e("div",{staticClass:"col-3"},[t._v("用时(秒)")]),t._v(" "),e("div",{staticClass:"col-4"},[t._v("复盘")]),t._v(" "),e("div",{staticClass:"col-5"},[t._v("时间")])])}]};var d=e("VU/8")(u,h,!1,function(t){e("OZyY")},"data-v-64de8318",null).exports,p={name:"nas-game",data:()=>({mnm:[],isOver:!1,step:0,numSafe:0,num:0,mine:0,isBegin:!1,startTimeStamp:0,endTimeStamp:0,playTime:0,timer:null,userBehaviorArr:[],isReview:!1,successDialogVisible:!1,FailDialogVisible:!1,isRetry:!1}),mounted(){this.initGame()},methods:{initGame(){const t=this.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});this.$api.simulateCall({funcName:"getMap",args:[]}).then(s=>{s=JSON.parse(s);let e=JSON.parse(s.data);this.mnm=e.map,this.mapId=s.id,this.num=e.num,this.mine=e.mine,t.close(),this.isRetry&&(this.startTimeStamp=new Date,this.timer=setInterval(()=>{let t=new Date;this.playTime=Math.round((t-this.startTimeStamp)/100)/10},100))}).catch(t=>{this.$message.error("获取地图异常，请稍后再试"),console.error(t)})},rightClick(t){if(!this.isBegin)return void this.$message.error('挑战尚未开始，请先点击"开始游戏"！');if(this.isOver)return void this.$message.error('挑战已结束，请先点击"重新开始"刷新地图！');let s={type:"right-click",item:t};this.userBehaviorArr.push(s);let e=this.mnm;e[t.y][t.x].isMark=!e[t.y][t.x].isMark,this.mnm=e},clickItem(t){if(!this.isBegin)return void this.$message.error('挑战尚未开始，请先点击"开始游戏"！');if(this.isOver)return void this.$message.error('挑战已结束，请先点击"重新开始"刷新地图！');let s={type:"left-click",item:t};if(this.userBehaviorArr.push(s),this.getAroundList(t.x,t.y),t.isMine||this.numSafe>=this.num*this.num-this.mine-1)this.isOver=!0,this.numSafe>=this.num*this.num-this.mine-1?this.successDialogVisible=!0:this.FailDialogVisible=!0,this.endTimeStamp=new Date,clearInterval(this.timer);else{let s=this.mnm;s[t.y][t.x].isSafe||(s[t.y][t.x].isSafe=!0,this.numSafe++),this.mnm=s,0==s[t.y][t.x].numMine&&this.checkAround(s,t.x,t.y)}},getAroundList(t,s){let e=[];return t>0&&(e.push([t-1,s]),s>0&&e.push([t-1,s-1])),s>0&&(e.push([t,s-1]),t+1<this.num&&e.push([t+1,s-1])),t+1<this.num&&(e.push([t+1,s]),s+1<this.num&&e.push([t+1,s+1])),s+1<this.num&&(e.push([t,s+1]),t>0&&e.push([t-1,s+1])),e},exceptList(t,s){let e=this.getAroundList(t,s),i=[],a=this;return e.forEach(function([t,s]){a.mnm[s][t].isSafe||i.push([t,s])}),i},checkAround(t,s,e){this.exceptList(s,e).forEach(function([s,e]){t[e][s].isSafe||(t[e][s].isSafe=!0,this.numSafe++),this.mnm=t,0==t[e][s].numMine&&this.$nextTick(()=>{this.checkAround(t,s,e)})},this)},operateGame(){this.userBehaviorArr=[],this.numSafe=0,this.isBegin=!0,this.isOver=!1,this.playTime=0,this.timer?(clearInterval(this.timer),this.isRetry=!0,this.initGame()):(this.startTimeStamp=new Date,this.timer=setInterval(()=>{let t=new Date;this.playTime=Math.round((t-this.startTimeStamp)/100)/10},100))},uploadResult(){this.successDialogVisible=!1,this.$api.call({funcName:"onPost",args:[this.playTime,JSON.stringify(this.userBehaviorArr),this.mapId,""]}).then(t=>{this.$message({message:"刷新我的战绩完成",type:"success"})}).catch(t=>{console.error(t),this.$message.error("数据上传失败，十分抱歉")})},jumpMyList(){this.$router.push({name:"MyList"})},jumpRankingList(){this.$router.push({name:"RankList"})}}},v={render:function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"sec-game"},[e("h1",{staticClass:"title"},[t._v("游戏页面")]),t._v(" "),e("div",{staticClass:"game-box"},[e("el-button",{attrs:{type:"primary",plain:""},on:{click:function(s){t.operateGame()}}},[t._v(t._s(t.isBegin||t.isOver?"重新开始":"开始游戏"))]),t._v(" "),e("el-button",{on:{click:function(s){t.jumpMyList()}}},[t._v("我的战绩")]),t._v(" "),e("el-button",{attrs:{type:"info"},on:{click:function(s){t.jumpRankingList()}}},[t._v("英雄榜 >")]),t._v(" "),e("div",{staticClass:"mine-box"},[e("p",{staticClass:"time"},[t._v("游戏时间："+t._s(t.playTime)+"秒")]),t._v(" "),e("div",{staticClass:"block-box"},t._l(t.mnm,function(s){return e("ul",{staticClass:"mine-map"},t._l(s,function(s){return e("li",{class:{isMine:s.isMine&&t.isOver,isSafe:s.isSafe||t.isOver&&!s.isMine,isMark:s.isMark},on:{click:function(e){t.clickItem(s)},contextmenu:function(e){e.preventDefault(),t.rightClick(s)}}},[t._v("\n                        "+t._s((s.isSafe||t.isOver)&&s.numMine&&!s.isMine?s.numMine:"")+"\n                    ")])}))})),t._v(" "),e("ol",{staticClass:"rule"},[e("li",[t._v("游戏说明：")]),t._v(" "),e("li",[t._v('1、点击"开始游戏"按钮，开始计时，游戏开始')]),t._v(" "),e("li",[t._v("2、鼠标左键点击翻开单元格，格子上的数字表示周围8个格子(上、下、左、右、左上、左下、右上、右下)中的地雷个数")]),t._v(" "),e("li",[t._v("3、使用鼠标右键可标记地雷")]),t._v(" "),e("li",[t._v("4、游戏结束后，可上传游戏成绩，并根据游戏时间进行世界排名")]),t._v(" "),e("li",[t._v("5、单元格为 "+t._s(t.num)+" * "+t._s(t.num)+" ，共有"+t._s(t.mine)+"个地雷")])])]),t._v(" "),e("el-dialog",{attrs:{title:"提示",visible:t.successDialogVisible,width:"30%",center:""},on:{"update:visible":function(s){t.successDialogVisible=s}}},[e("p",{staticClass:"dialog-tip dialog-status"},[t._v("扫雷成功！")]),t._v(" "),e("p",{staticClass:"dialog-tip"},[t._v('点击"确定"，即可上传您的游戏成绩参与世界排名')]),t._v(" "),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(s){t.successDialogVisible=!1}}},[t._v("取 消")]),t._v(" "),e("el-button",{attrs:{type:"primary"},on:{click:function(s){t.uploadResult()}}},[t._v("确 定")])],1)]),t._v(" "),e("el-dialog",{attrs:{title:"提示",visible:t.FailDialogVisible,width:"30%",center:""},on:{"update:visible":function(s){t.FailDialogVisible=s}}},[e("p",{staticClass:"dialog-tip dialog-status"},[t._v("很遗憾，失败了...")]),t._v(" "),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(s){t.FailDialogVisible=!1}}},[t._v("关 闭")])],1)])],1)])},staticRenderFns:[]};var f=e("VU/8")(p,v,!1,function(t){e("09Ht")},"data-v-467eb80a",null).exports,g={name:"page-my-list",data:()=>({isLoad:!0,list:[]}),created(){this.refreshData()},methods:{refreshData(){this.isLoad=!0,this.$api.simulateCall({funcName:"findMyScore",args:[]}).then(t=>{this.isLoad=!1,(t=JSON.parse(t)||[]).sort((t,s)=>t.timestamp>s.timestamp),this.list=t,this.$message({message:"刷新我的战绩完成",type:"success"})}).catch(t=>{this.isLoad=!1,this.list=[],this.$message.error("获取我的战绩异常，请稍后再试"),console.error(t)})},goPlayPage(){this.$router.push({name:"Game"})},replay(t){this.$router.push({name:"Replay",params:{id:t}})}}},_={render:function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"page-my-list main-section"},[e("h1",{staticClass:"title"},[t._v("我的战绩")]),t._v(" "),e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.isLoad,expression:"isLoad"}],staticClass:"my-list-con"},[t.isLoad?t._e():e("div",[t.list.length<1?e("div",{staticClass:"empty-holder"},[t._v("\n        还没有您的战绩哟 "),e("el-button",{on:{click:t.goPlayPage}},[t._v("立即开始")])],1):e("div",[e("div",{staticClass:"my-list"},[e("el-table",{staticStyle:{width:"100%",margin:"0 auto"},attrs:{data:t.list}},[e("el-table-column",{attrs:{label:"时间",width:"500"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("div",{staticClass:"date-time"},[t._v(t._s(new Date(1e3*s.row.timestamp).toLocaleString()))])]}}])}),t._v(" "),e("el-table-column",{attrs:{align:"left",prop:"time",label:"用时(秒)",width:"200"}}),t._v(" "),e("el-table-column",{attrs:{align:"center",label:"复盘",width:"380"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("el-button",{on:{click:function(e){t.replay(s.row.id)}}},[t._v("复盘")])]}}])})],1)],1)])])]),t._v(" "),e("j-play-btn")],1)},staticRenderFns:[]};var y=e("VU/8")(g,_,!1,function(t){e("eKfs")},"data-v-ad8e0216",null).exports,L={name:"nas-page-replay",data:()=>({isLoad:!0,mnm:[],step:[],num:0,mine:0,nickname:"",time:"",isOver:!1,reviewStep:0,replayEndDialog:!1}),mounted(){this.fetchGameData()},methods:{fetchGameData(){const t=this.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});let s=this.$route.params.id;this.isLoad=!0,this.$api.simulateCall({funcName:"replay",args:[s]}).then(s=>{this.isLoad=!1,s=JSON.parse(s),this.nickname=s.user.nickname,this.time=s.score.time,this.$message({message:"取得复盘数据，可以开始观看大神"+this.nickname+"的表演了",type:"success"}),this.step=JSON.parse(s.score.step);let e=JSON.parse(s.map.data);this.mnm=e.map,this.num=e.num,this.mine=e.mine,console.log(e,this.mnm),t.close()}).catch(t=>{this.isLoad=fasle,this.$message.error("获取对战数据异常，请稍后再试"),console.error(t)})},rightClick(t){let s=this.mnm;s[t.y][t.x].isMark=!s[t.y][t.x].isMark,this.mnm=s},clickItem(t){if(this.getAroundList(t.x,t.y),t.isMine||this.numSafe>=this.num*this.num-this.mine)this.isOver=!0,this.endTimeStamp=new Date,clearInterval(this.timer);else{let s=this.mnm;s[t.y][t.x].isSafe||(s[t.y][t.x].isSafe=!0,this.numSafe++),this.mnm=s,0==s[t.y][t.x].numMine&&this.checkAround(s,t.x,t.y)}},getAroundList(t,s){let e=[];return t>0&&(e.push([t-1,s]),s>0&&e.push([t-1,s-1])),s>0&&(e.push([t,s-1]),t+1<this.num&&e.push([t+1,s-1])),t+1<this.num&&(e.push([t+1,s]),s+1<this.num&&e.push([t+1,s+1])),s+1<this.num&&(e.push([t,s+1]),t>0&&e.push([t-1,s+1])),e},exceptList(t,s){let e=this.getAroundList(t,s),i=[],a=this;return e.forEach(function([t,s]){a.mnm[s][t].isSafe||i.push([t,s])}),i},checkAround(t,s,e){this.exceptList(s,e).forEach(function([s,e]){t[e][s].isSafe||(t[e][s].isSafe=!0,this.numSafe++),this.mnm=t,0==t[e][s].numMine&&this.$nextTick(()=>{this.checkAround(t,s,e)})},this)},autoPlay(){let t=this,s=this.step;this.isReview=!0,this.isOver=!1,this.numSafe=0,0!==s.length&&(this.reviewInterval=setInterval(()=>{let s=t.step,e=t.reviewStep;if(e>=s.length)return clearInterval(t.reviewInterval),void(t.replayEndDialog=!0);let i=s[e].type,a=s[e].item;"left-click"===i?this.clickItem(a):this.rightClick(a),t.reviewStep++},1e3))},reloadPage(){location.reload()},toPlay(){this.$router.push({name:"Game"})}}},k={render:function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"page-replay"},[e("h1",[t._v("复盘页面——看大神的游戏记录")]),t._v(" "),e("p",{staticClass:"user-name"},[t._v("玩家："),e("span",{staticClass:"name"},[t._v(t._s(t.nickname))])]),t._v(" "),e("p",{staticClass:"user-name"},[t._v("该记录耗时："),e("span",{staticClass:"name"},[t._v(t._s(t.time))]),t._v("秒")]),t._v(" "),e("el-button",{attrs:{type:"primary",plain:""},on:{click:function(s){t.autoPlay()}}},[t._v("自动播放")]),t._v(" "),e("el-button",{on:{click:function(s){t.toPlay()}}},[t._v("我也玩一局")]),t._v(" "),e("div",{staticClass:"block-box"},t._l(t.mnm,function(s){return e("ul",{staticClass:"mine-map"},t._l(s,function(s){return e("li",{class:{isMine:s.isMine&&t.isOver,isSafe:s.isSafe||t.isOver&&!s.isMine,isMark:s.isMark}},[t._v("\n                "+t._s((s.isSafe||t.isOver)&&s.numMine&&!s.isMine?s.numMine:"")+"\n            ")])}))})),t._v(" "),e("el-dialog",{attrs:{title:"提示",visible:t.replayEndDialog,width:"30%",center:""},on:{"update:visible":function(s){t.replayEndDialog=s}}},[e("p",{staticClass:"dialog-tip dialog-status"},[t._v("演示结束啦！")]),t._v(" "),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(s){t.replayEndDialog=!1}}},[t._v("取 消")]),t._v(" "),e("el-button",{attrs:{type:"primary"},on:{click:function(s){t.reloadPage()}}},[t._v("重新观看")])],1)])],1)},staticRenderFns:[]};var b=e("VU/8")(L,k,!1,function(t){e("4j6Z")},"data-v-1b20fb76",null).exports;a.default.use(m.a);var C=new m.a({routes:[{path:"/",name:"RankList",component:d},{path:"/game",name:"Game",component:f},{path:"/myList",name:"MyList",component:y},{path:"/replay/:id",name:"Replay",component:b}]}),w=e("NYxO"),S=e("6fn7"),M=e.n(S);let x="n1jdGw5xciE4nUuJRgxsCcEHGe8syBDPEeL";console.log(`contract addr: ${x}`);const $=new M.a;function R(t){const s=t.funcName,e=JSON.stringify(t.args||[]);return new Promise((t,i)=>{$.simulateCall(x,"0",s,e,{listener:function(e){if(console.log(`simulateCall [${s}] 返回结果：`,e),e.result&&!e.execute_err){let s=e.result;t(s)}else i(e)}})})}function D(t){const s=t.funcName,e=JSON.stringify(t.args||[]);return new Promise((t,i)=>{$.call(x,"0",s,e,{listener:function(e){console.log(`call [${s}] 返回结果：`,e),"string"==typeof e&&0===e.indexOf("Error:")?i(new Error(e)):t(e)}})})}a.default.use(w.a);var O=new w.a.Store({state:{isLoading:!1,lostList:[],rewardList:[],myLostList:[],myRewardList:[]},mutations:{setLostList(t,s){t.lostList=s||[]},updateLoadStatus(t,s){t.isLoading=s},setRewardList(t,s){t.rewardList=s||[]},setMyLostList(t,s){t.myLostList=s||[]},setMyRewardList(t,s){t.myRewardList=s||[]}},actions:{publishLost:({commit:t,state:s},e)=>D({funcName:"onPost",args:[e.title,e.desc,e.time,e.location,e.contact]}),fetchLostList:({commit:t,state:s},e)=>R({funcName:"listPost",args:[]}).then(e=>{t("setLostList",s.lostList.concat(e.online))}),publishReward:({commit:t,state:s},e)=>D({funcName:"onReward",args:[e.title,e.desc,e.time,e.location,e.contact,e.money]}),fetchRewardList:({commit:t,state:s},e)=>R({funcName:"listReward",args:[]}).then(e=>{t("setRewardList",s.rewardList.concat(e.online))}),fetchMyList:({commit:t,state:s},e)=>R({funcName:"findMyPost",args:[]}).then(e=>{t("setMyRewardList",s.myRewardList.concat(e.reward||[])),t("setMyLostList",s.myLostList.concat(e.post||[]))}),offLost:({commit:t,state:s},e)=>D({funcName:"offPost",args:[e.id]}).then(t=>(s.myLostList.forEach(t=>{t.id===e.id&&(t.status=2)}),t)),offReward:({commit:t,state:s},e)=>D({funcName:"offReward",args:[e.id]}).then(t=>(s.myRewardList.forEach(t=>{t.id===e.id&&(t.status=2)}),t))}}),N={name:"j-play-btn",methods:{goPlayPage(){this.$router.push({name:"Game"})}}},E={render:function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"j-play-btn"},[s("el-button",{staticClass:"btn",attrs:{type:"primary"},on:{click:this.goPlayPage}},[this._v("立即挑战")])],1)},staticRenderFns:[]};var P=e("VU/8")(N,E,!1,function(t){e("BYMy")},"data-v-2834b99d",null).exports;a.default.config.productionTip=!1,a.default.use(l.a),a.default.component(P.name,P),a.default.prototype.$api=i,new a.default({el:"#app",router:C,store:O,components:{App:c},template:"<App/>"})},OZyY:function(t,s){},YgDj:function(t,s){},eKfs:function(t,s){},tvR6:function(t,s){}},["NHnr"]);