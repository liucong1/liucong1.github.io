webpackJsonp([1],{BjA0:function(t,e){},GRca:function(t,e){},NHnr:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i={};s.d(i,"simulateCall",function(){return x}),s.d(i,"call",function(){return N});var a=s("7+uW"),n=s("zL8q"),l=s.n(n),r=(s("tvR6"),{name:"App",created(){"undefined"==typeof webExtensionWallet&&alert("请安装并且登录钱包")},methods:{handleMenuClick(t,e){console.log("menu click: ",t,e),this.$router.push({name:t})}}}),o={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"app"}},[this._m(0),this._v(" "),e("router-view")],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("h1",{staticClass:"app-title"},[e("span",[this._v("扫雷争霸")])])}]};var c=s("VU/8")(r,o,!1,function(t){s("pHd6")},null,null).exports,m=s("/ocq"),u={name:"nas-rank-list",data:()=>({isLoad:!0,list:[]}),created(){this.fetchRankList()},methods:{fetchRankList(){this.isLoad=!0,this.$api.simulateCall({funcName:"listRank",args:[]}).then(t=>{t=JSON.parse(t),this.isLoad=!1;let e=t||[];e.sort((t,e)=>t.time-e.time),this.list=e,this.$message({message:"刷新英雄榜完成",type:"success"})}).catch(t=>{this.isLoad=!1,this.list=[],this.$message.error("获取英雄榜异常，请稍后再试"),console.error(t)})},replayGame(t){this.$router.push({name:"Replay",params:{id:t}})}}},h={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"sec-rank-list main-section"},[s("h1",{staticClass:"title"},[t._v("全球英雄榜")]),t._v(" "),s("j-play-btn",{attrs:{showMyListBtn:!0}}),t._v(" "),s("div",{directives:[{name:"loading",rawName:"v-loading",value:t.isLoad,expression:"isLoad"}],staticClass:" rank-list-con"},[t.isLoad?t._e():s("div",[t.list.length<1?s("div",{staticClass:"empty-holder"},[t._v("\n                还木有英雄榜，去挑战一下吧:)\n            ")]):s("div",{staticClass:"rank-list"},[t._m(0),t._v(" "),t._l(t.list,function(e,i){return s("div",{key:e.id,staticClass:"list-item row clearfix"},[s("div",{staticClass:"col-1"},[t._v(t._s(i+1))]),t._v(" "),s("div",{staticClass:"col-2"},[t._v(t._s(e.from))]),t._v(" "),s("div",{staticClass:"col-3"},[t._v(t._s(e.time))]),t._v(" "),s("div",{staticClass:"col-4"},[s("el-button",{on:{click:function(s){t.replayGame(e.id)}}},[t._v("复盘")])],1),t._v(" "),s("div",{staticClass:"col-5"},[t._v(t._s(new Date(1e3*e.timestamp).toLocaleString()))])])})],2)])])],1)},staticRenderFns:[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"list-header row clearfix"},[s("div",{staticClass:"col-1"},[t._v("排名")]),t._v(" "),s("div",{staticClass:"col-2"},[t._v("用户")]),t._v(" "),s("div",{staticClass:"col-3"},[t._v("用时(秒)")]),t._v(" "),s("div",{staticClass:"col-4"},[t._v("复盘")]),t._v(" "),s("div",{staticClass:"col-5"},[t._v("时间")])])}]};var d=s("VU/8")(u,h,!1,function(t){s("BjA0")},"data-v-580f76f2",null).exports,p={name:"nas-game",data:()=>({mnm:[],isOver:!1,step:0,numSafe:0,num:0,mine:0,isBegin:!1,startTimeStamp:0,endTimeStamp:0,playTime:0,timer:null,userBehaviorArr:[],isReview:!1,successDialogVisible:!1,FailDialogVisible:!1,isRetry:!1}),mounted(){this.initGame()},methods:{initGame(){const t=this.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});this.$api.simulateCall({funcName:"getMap",args:[]}).then(e=>{e=JSON.parse(e);let s=JSON.parse(e.data);this.mnm=s.map,this.mapId=e.id,this.num=s.num,this.mine=s.mine,t.close(),this.isRetry&&(this.startTimeStamp=new Date,this.timer=setInterval(()=>{let t=new Date;this.playTime=Math.round((t-this.startTimeStamp)/100)/10},100))}).catch(e=>{this.$message.error("获取地图异常，请稍后再试"),console.error(e),t.close()})},rightClick(t){if(!this.isBegin)return void this.$message.error('挑战尚未开始，请先点击"开始游戏"！');if(this.isOver)return void this.$message.error('挑战已结束，请先点击"重新开始"刷新地图！');let e={type:"right-click",item:t};this.userBehaviorArr.push(e);let s=this.mnm;s[t.y][t.x].isMark=!s[t.y][t.x].isMark,this.mnm=s},clickItem(t){if(!this.isBegin)return void this.$message.error('挑战尚未开始，请先点击"开始游戏"！');if(this.isOver)return void this.$message.error('挑战已结束，请先点击"重新开始"刷新地图！');let e={type:"left-click",item:t};if(this.userBehaviorArr.push(e),this.getAroundList(t.x,t.y),t.isMine||this.numSafe>=this.num*this.num-this.mine-1)this.isOver=!0,this.numSafe>=this.num*this.num-this.mine-1?this.successDialogVisible=!0:this.FailDialogVisible=!0,this.endTimeStamp=new Date,clearInterval(this.timer);else{let e=this.mnm;e[t.y][t.x].isSafe||(e[t.y][t.x].isSafe=!0,this.numSafe++),this.mnm=e,0==e[t.y][t.x].numMine&&this.checkAround(e,t.x,t.y)}},getAroundList(t,e){let s=[];return t>0&&(s.push([t-1,e]),e>0&&s.push([t-1,e-1])),e>0&&(s.push([t,e-1]),t+1<this.num&&s.push([t+1,e-1])),t+1<this.num&&(s.push([t+1,e]),e+1<this.num&&s.push([t+1,e+1])),e+1<this.num&&(s.push([t,e+1]),t>0&&s.push([t-1,e+1])),s},exceptList(t,e){let s=this.getAroundList(t,e),i=[],a=this;return s.forEach(function([t,e]){a.mnm[e][t].isSafe||i.push([t,e])}),i},checkAround(t,e,s){this.exceptList(e,s).forEach(function([e,s]){t[s][e].isSafe||(t[s][e].isSafe=!0,this.numSafe++),this.mnm=t,0==t[s][e].numMine&&this.$nextTick(()=>{this.checkAround(t,e,s)})},this)},operateGame(){this.userBehaviorArr=[],this.numSafe=0,this.isBegin=!0,this.isOver=!1,this.playTime=0,this.timer?(clearInterval(this.timer),this.isRetry=!0,this.initGame()):(this.startTimeStamp=new Date,this.timer=setInterval(()=>{let t=new Date;this.playTime=Math.round((t-this.startTimeStamp)/100)/10},100))},uploadResult(){this.successDialogVisible=!1,this.$api.call({funcName:"onPost",args:[this.playTime,JSON.stringify(this.userBehaviorArr),this.mapId,""]}).then(t=>{this.$message({message:"上传战绩成功，请稍后到【我的战绩】查看",type:"success"})}).catch(t=>{console.error(t),this.$message.error("数据上传失败，十分抱歉")})},jumpMyList(){this.$router.push({name:"MyList"})},jumpRankingList(){this.$router.push({name:"RankList"})}}},v={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"sec-game"},[s("h1",{staticClass:"title"},[t._v("游戏页面")]),t._v(" "),s("div",{staticClass:"game-box"},[s("el-button",{attrs:{type:"primary",plain:""},on:{click:function(e){t.operateGame()}}},[t._v(t._s(t.isBegin||t.isOver?"重新开始":"开始游戏"))]),t._v(" "),s("el-button",{on:{click:function(e){t.jumpMyList()}}},[t._v("我的战绩")]),t._v(" "),s("el-button",{attrs:{type:"info"},on:{click:function(e){t.jumpRankingList()}}},[t._v("英雄榜 >")]),t._v(" "),s("div",{staticClass:"mine-box"},[s("p",{staticClass:"time"},[t._v("游戏时间："+t._s(t.playTime)+"秒")]),t._v(" "),s("div",{staticClass:"block-box"},t._l(t.mnm,function(e){return s("ul",{staticClass:"mine-map"},t._l(e,function(e){return s("li",{class:{isMine:e.isMine&&t.isOver,isSafe:e.isSafe||t.isOver&&!e.isMine,isMark:e.isMark},on:{click:function(s){t.clickItem(e)},contextmenu:function(s){s.preventDefault(),t.rightClick(e)}}},[t._v("\n                        "+t._s((e.isSafe||t.isOver)&&e.numMine&&!e.isMine?e.numMine:"")+"\n                    ")])}))})),t._v(" "),s("ol",{staticClass:"rule"},[s("li",[t._v("游戏说明：")]),t._v(" "),s("li",[t._v('1、点击"开始游戏"按钮，开始计时，游戏开始')]),t._v(" "),s("li",[t._v("2、鼠标左键点击翻开单元格，格子上的数字表示周围8个格子(上、下、左、右、左上、左下、右上、右下)中的地雷个数")]),t._v(" "),s("li",[t._v("3、使用鼠标右键可标记地雷")]),t._v(" "),s("li",[t._v("4、游戏结束后，可上传游戏成绩，并根据游戏时间进行世界排名")]),t._v(" "),s("li",[t._v("5、单元格为 "+t._s(t.num)+" * "+t._s(t.num)+" ，共有"+t._s(t.mine)+"个地雷")])])]),t._v(" "),s("el-dialog",{attrs:{title:"提示",visible:t.successDialogVisible,width:"30%",center:""},on:{"update:visible":function(e){t.successDialogVisible=e}}},[s("p",{staticClass:"dialog-tip dialog-status"},[t._v("扫雷成功！")]),t._v(" "),s("p",{staticClass:"dialog-tip"},[t._v('点击"确定"，即可上传您的游戏成绩参与世界排名')]),t._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(e){t.successDialogVisible=!1}}},[t._v("取 消")]),t._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:function(e){t.uploadResult()}}},[t._v("确 定")])],1)]),t._v(" "),s("el-dialog",{attrs:{title:"提示",visible:t.FailDialogVisible,width:"30%",center:""},on:{"update:visible":function(e){t.FailDialogVisible=e}}},[s("p",{staticClass:"dialog-tip dialog-status"},[t._v("很遗憾，失败了...")]),t._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(e){t.FailDialogVisible=!1}}},[t._v("关 闭")])],1)])],1)])},staticRenderFns:[]};var f=s("VU/8")(p,v,!1,function(t){s("GRca")},"data-v-7132ba58",null).exports,g={name:"page-my-list",data:()=>({isLoad:!0,list:[]}),created(){this.refreshData()},methods:{refreshData(){this.isLoad=!0,this.$api.simulateCall({funcName:"findMyScore",args:[]}).then(t=>{this.isLoad=!1,(t=JSON.parse(t)||[]).sort((t,e)=>t.timestamp-e.timestamp),this.list=t,this.$message({message:"刷新我的战绩完成",type:"success"})}).catch(t=>{this.isLoad=!1,this.list=[],this.$message.error("获取我的战绩异常，请稍后再试"),console.error(t)})},goPlayPage(){this.$router.push({name:"Game"})},replay(t){this.$router.push({name:"Replay",params:{id:t}})}}},_={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"page-my-list main-section"},[s("h1",{staticClass:"title"},[t._v("我的战绩")]),t._v(" "),s("j-play-btn",{attrs:{showRankBtn:!0}}),t._v(" "),s("div",{directives:[{name:"loading",rawName:"v-loading",value:t.isLoad,expression:"isLoad"}],staticClass:"my-list-con"},[t.isLoad?t._e():s("div",[t.list.length<1?s("div",{staticClass:"empty-holder"},[t._v("\n        还没有您的战绩哟~\n      ")]):s("div",[s("div",{staticClass:"my-list"},[s("el-table",{staticStyle:{width:"100%",margin:"0 auto"},attrs:{data:t.list}},[s("el-table-column",{attrs:{label:"时间",width:"500"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("div",{staticClass:"date-time"},[t._v(t._s(new Date(1e3*e.row.timestamp).toLocaleString()))])]}}])}),t._v(" "),s("el-table-column",{attrs:{align:"left",prop:"time",label:"用时(秒)",width:"200"}}),t._v(" "),s("el-table-column",{attrs:{align:"center",label:"复盘",width:"380"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("el-button",{on:{click:function(s){t.replay(e.row.id)}}},[t._v("复盘")])]}}])})],1)],1)])])])],1)},staticRenderFns:[]};var y=s("VU/8")(g,_,!1,function(t){s("XeIo")},"data-v-1bce48ab",null).exports,L={name:"nas-page-replay",data:()=>({isLoad:!0,mnm:[],step:[],num:0,mine:0,nickname:"",time:"",isOver:!1,reviewStep:0,replayEndDialog:!1}),mounted(){this.fetchGameData()},methods:{fetchGameData(){const t=this.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});let e=this.$route.params.id;this.isLoad=!0,this.$api.simulateCall({funcName:"replay",args:[e]}).then(e=>{this.isLoad=!1,e=JSON.parse(e),this.nickname=e.user.from,this.time=e.score.time,this.$message({message:"取得复盘数据，可以开始观看大神"+this.nickname+"的表演了",type:"success"}),this.step=JSON.parse(e.score.step);let s=JSON.parse(e.map.data);this.mnm=s.map,this.num=s.num,this.mine=s.mine,console.log(s,this.mnm),t.close()}).catch(t=>{this.isLoad=fasle,this.$message.error("获取对战数据异常，请稍后再试"),console.error(t)})},rightClick(t){let e=this.mnm;e[t.y][t.x].isMark=!e[t.y][t.x].isMark,this.mnm=e},clickItem(t){if(this.getAroundList(t.x,t.y),t.isMine||this.numSafe>=this.num*this.num-this.mine)this.isOver=!0,this.endTimeStamp=new Date,clearInterval(this.timer);else{let e=this.mnm;e[t.y][t.x].isSafe||(e[t.y][t.x].isSafe=!0,this.numSafe++),this.mnm=e,0==e[t.y][t.x].numMine&&this.checkAround(e,t.x,t.y)}},getAroundList(t,e){let s=[];return t>0&&(s.push([t-1,e]),e>0&&s.push([t-1,e-1])),e>0&&(s.push([t,e-1]),t+1<this.num&&s.push([t+1,e-1])),t+1<this.num&&(s.push([t+1,e]),e+1<this.num&&s.push([t+1,e+1])),e+1<this.num&&(s.push([t,e+1]),t>0&&s.push([t-1,e+1])),s},exceptList(t,e){let s=this.getAroundList(t,e),i=[],a=this;return s.forEach(function([t,e]){a.mnm[e][t].isSafe||i.push([t,e])}),i},checkAround(t,e,s){this.exceptList(e,s).forEach(function([e,s]){t[s][e].isSafe||(t[s][e].isSafe=!0,this.numSafe++),this.mnm=t,0==t[s][e].numMine&&this.$nextTick(()=>{this.checkAround(t,e,s)})},this)},autoPlay(){let t=this,e=this.step;this.isReview=!0,this.isOver=!1,this.numSafe=0,0!==e.length&&(this.reviewInterval=setInterval(()=>{let e=t.step,s=t.reviewStep;if(s>=e.length)return clearInterval(t.reviewInterval),void(t.replayEndDialog=!0);let i=e[s].type,a=e[s].item;"left-click"===i?this.clickItem(a):this.rightClick(a),t.reviewStep++},1e3))},reloadPage(){location.reload()},toPlay(){this.$router.push({name:"Game"})}}},k={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"page-replay"},[s("h1",{staticClass:"title"},[t._v("复盘页面——看大神的游戏记录")]),t._v(" "),s("p",{staticClass:"user-name"},[t._v("玩家："),s("span",{staticClass:"name"},[t._v(t._s(t.nickname))])]),t._v(" "),s("p",{staticClass:"user-name"},[t._v("该记录耗时："),s("span",{staticClass:"name"},[t._v(t._s(t.time))]),t._v("秒")]),t._v(" "),s("el-button",{attrs:{type:"primary",plain:""},on:{click:function(e){t.autoPlay()}}},[t._v("自动播放")]),t._v(" "),s("el-button",{on:{click:function(e){t.toPlay()}}},[t._v("我也玩一局")]),t._v(" "),s("div",{staticClass:"block-box"},t._l(t.mnm,function(e){return s("ul",{staticClass:"mine-map"},t._l(e,function(e){return s("li",{class:{isMine:e.isMine&&t.isOver,isSafe:e.isSafe||t.isOver&&!e.isMine,isMark:e.isMark}},[t._v("\n                "+t._s((e.isSafe||t.isOver)&&e.numMine&&!e.isMine?e.numMine:"")+"\n            ")])}))})),t._v(" "),s("el-dialog",{attrs:{title:"提示",visible:t.replayEndDialog,width:"30%",center:""},on:{"update:visible":function(e){t.replayEndDialog=e}}},[s("p",{staticClass:"dialog-tip dialog-status"},[t._v("演示结束啦！")]),t._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(e){t.replayEndDialog=!1}}},[t._v("取 消")]),t._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:function(e){t.reloadPage()}}},[t._v("重新观看")])],1)])],1)},staticRenderFns:[]};var w=s("VU/8")(L,k,!1,function(t){s("yDn7")},"data-v-94a14a4e",null).exports;a.default.use(m.a);var b=new m.a({routes:[{path:"/",name:"RankList",component:d},{path:"/game",name:"Game",component:f},{path:"/myList",name:"MyList",component:y},{path:"/replay/:id",name:"Replay",component:w}]}),C=s("NYxO"),S=s("6fn7"),M=s.n(S);let R="n1jz37LNKFpuWpEzRaNH3gWJ2BfjifZCkMk";console.log(`contract addr: ${R}`);const $=new M.a;function x(t){const e=t.funcName,s=JSON.stringify(t.args||[]);return new Promise((t,i)=>{$.simulateCall(R,"0",e,s,{listener:function(s){if(console.log(`simulateCall [${e}] 返回结果：`,s),s.result&&!s.execute_err){let e=s.result;t(e)}else"insufficient balance"===s.execute_err&&n.Notification.warning({title:"钱包报错",message:"您的账户余额不足，请充值后再进行操作",duration:0}),i(s)}})})}function N(t){const e=t.funcName,s=JSON.stringify(t.args||[]);return new Promise((t,i)=>{$.call(R,"0",e,s,{listener:function(s){console.log(`call [${e}] 返回结果：`,s),"string"==typeof s&&0===s.indexOf("Error:")?i(new Error(s)):t(s)}})})}a.default.use(C.a);var D=new C.a.Store({state:{isLoading:!1,lostList:[],rewardList:[],myLostList:[],myRewardList:[]},mutations:{setLostList(t,e){t.lostList=e||[]},updateLoadStatus(t,e){t.isLoading=e},setRewardList(t,e){t.rewardList=e||[]},setMyLostList(t,e){t.myLostList=e||[]},setMyRewardList(t,e){t.myRewardList=e||[]}},actions:{publishLost:({commit:t,state:e},s)=>N({funcName:"onPost",args:[s.title,s.desc,s.time,s.location,s.contact]}),fetchLostList:({commit:t,state:e},s)=>x({funcName:"listPost",args:[]}).then(s=>{t("setLostList",e.lostList.concat(s.online))}),publishReward:({commit:t,state:e},s)=>N({funcName:"onReward",args:[s.title,s.desc,s.time,s.location,s.contact,s.money]}),fetchRewardList:({commit:t,state:e},s)=>x({funcName:"listReward",args:[]}).then(s=>{t("setRewardList",e.rewardList.concat(s.online))}),fetchMyList:({commit:t,state:e},s)=>x({funcName:"findMyPost",args:[]}).then(s=>{t("setMyRewardList",e.myRewardList.concat(s.reward||[])),t("setMyLostList",e.myLostList.concat(s.post||[]))}),offLost:({commit:t,state:e},s)=>N({funcName:"offPost",args:[s.id]}).then(t=>(e.myLostList.forEach(t=>{t.id===s.id&&(t.status=2)}),t)),offReward:({commit:t,state:e},s)=>N({funcName:"offReward",args:[s.id]}).then(t=>(e.myRewardList.forEach(t=>{t.id===s.id&&(t.status=2)}),t))}}),O={name:"j-play-btn",props:{showRankBtn:{type:Boolean,default:!1},showPlayBtn:{type:Boolean,default:!0},showMyListBtn:{type:Boolean,default:!1}},methods:{goPlayPage(){this.$router.push({name:"Game"})},goRankListPage(){this.$router.push({name:"RankList"})},goMyListPage(){this.$router.push({name:"MyList"})}}},P={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"j-play-btn"},[t.showPlayBtn?s("el-button",{attrs:{type:"primary"},on:{click:t.goPlayPage}},[t._v("立即挑战")]):t._e(),t._v(" "),t.showRankBtn?s("el-button",{attrs:{type:"primary",plain:""},on:{click:t.goRankListPage}},[t._v("英雄榜")]):t._e(),t._v(" "),t.showMyListBtn?s("el-button",{on:{click:t.goMyListPage}},[t._v("我的战绩")]):t._e()],1)},staticRenderFns:[]};var B=s("VU/8")(O,P,!1,function(t){s("i2VL")},"data-v-42659d65",null).exports;a.default.config.productionTip=!1,a.default.use(l.a),a.default.component(B.name,B),a.default.prototype.$api=i,new a.default({el:"#app",router:b,store:D,components:{App:c},template:"<App/>"})},XeIo:function(t,e){},i2VL:function(t,e){},pHd6:function(t,e){},tvR6:function(t,e){},yDn7:function(t,e){}},["NHnr"]);